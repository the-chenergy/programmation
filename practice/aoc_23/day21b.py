from ipython_startup.imports import *

inp_o = '''\
...................................................................................................................................
.#.........#....#.....#...............#.................#..#...........#..........................#........#.......#..#.........#..
......##.#.....#......#....##....#......................#.#............#.........#......#.....................#................#...
....##.....##...........#.##......#.#....##.........#...................#......#.#....#...#..........#.........#........#......#...
......#..................##..#..........#..#.......#..#..#......................#.................#......#..#......#........#..#...
....#.........#..#..#.#......#.#.....#.#..#...........#.....................#......#......#........#....##...................#.....
..#......#..#........#.#.#.....#.......#......#...#.............#...............#...................#.........#....#.#...........#.
............#..................#...................#...........#..........................#............#.#.....#................#..
..#......#.....#..........#.........#............#.#.........#.....................#......#.................................##.....
...#.............................#.......#....................#....#.........................##........#...#................#......
.........#.......#...#............#......#............................................#.....#..........#...#......#......#.........
.....#.......#.................................................#..#.................#........#....##...............................
....................#.#........#..............#..............#............................#................#.......#..#.........#..
..........#.....#......#...........................................#...............#..##.....#.....#.#..............#..............
.#..............#...#..........#.............................#..#..#....#............#....................#......................#.
...###..............#.#.........#........................#...#..........................###...#.......#.#....................#.#...
......#...............#.#..#.........................#......................#........#.....#......#.................#......#.......
.............#................#............................#......#......#............#.....#....#....................#......##....
........................##.#...##..........#...........#.#...##........#...#...........#............##...#....................#..#.
.....#........#....#..#.................##................#....#....#.....#.................#.......#.#............................
...........#......................#.................#..#.#.....##...#.#....#..#...............#...#.....#...#..#..##......#.#....#.
...#...................#........................#......#................#..#.........................#..........#..................
........##..#.#................#..#.......................#.....#...........................#........#....#........................
...#............#.....#..........#.............##........#..#...#...........................#........#.##.....#..............#.....
..#.#.........#.......#.....#........#.........#.#...#.....#...........#..........#.............#...............###...#............
.........##........#...#....................#...#..#......#...........................#.............................#......#.......
.........#....#...........##................#...........##...#..#..#.............#................#.........................#....#.
.....#.....#...#.........#.......................#........#...#....#...#.........#.....#...............#...#.............#.........
..#....#..##.......#...#.........#........#......#.................#...#.......................................#......#............
.....................#....#..........................#..#...#......##....#.........#..#..............#..................#..........
.............#...##..##..............................#..#..#......#.........................................#..##...#..............
.......#.....#.........#...........................#........#...........#...........##...........................#.......#.........
..................#.#...................#......#..............#..............#.....#..#.#...................#.#...#..........#.....
.......................#...#.............#....#.##.###....##..........#......#..#.............#.........#......#..........#........
.#............#...........#..........#...#....#....#........................................##.........#..#........#.........#.....
....#...............................#......##............##.......#..............#......#....##...................#...#....#.......
.....#....#...##....#.#.....................#......#............................##.......#......#................#...............#.
..........#.#..#..#...........................#........#......#.................#...........................#..#......#...#........
...#.....#......................#...#...............#.##........#.###..........##..................#.........#.....................
..#..........#.......#.............#.........#....#...............#...#..#....#....#.#................................#.#...#......
.......#.......##....................#.##.......#...#.............#.............#.#...#......#..#...............#....#.............
..........#...................................#.......................##...#..............#.........#.....................#........
............##..#.........................#................................#...#..#...#..........#...#................#..#.........
..#.......##.#........................#..#....#....#..#.#.#........#...#........#................#.....#......................#.#..
..#...#.#....................#.......#.......#.#.##..#.....#..........#..........#.............#......#.#.........#................
....#....#.....#...........#.#.....#......#..................#..........#.......#................#................##...............
.#......#.................#...#..##.......#..#..........#...............#..........#....#.#...#......#.........................#...
..#.#.#...#...........#....#................##.............#..#..............#...#....#...##....#.........................#........
..#.....#...#..............#.......#..#...........................#...........#..........#..........#...#..............#......#.#..
..#...................#.........##............#....#..................#...............#..........#.......#.........................
......................................#........................#...#.......................#.......#........................#......
...#..#..#..........#.....#...........................................#.......#.............#......#.......#....#.........#........
..##.........................#.....#.................#..................##...##.....#.......#.........#...#.....#..............#...
..#.............#...##.#......................#....#.........##......#...........#..............#..#........#.....#.............##.
.....................#.#......................#..........#...##...........#............#.....#....................#..............#.
................#...#.......#............#.....#..#...##.#...#....#...#......#.#........#..........##........#.#....#..............
.............#...........#..............#..#.....#.........#...................................#.#.................................
.#..................#....#..........#.#..#........#.......................#..#.......#..................#.#.....................#..
................#.......#............................#............#..#.................#.#...#.....................................
............#.#............#........#.##........###..#........###......#.........................##.#.......#.......##.............
............#.#.......#.......#..##....#....................#.......................................#.....#.........#...#..........
...........##.....#..#...................#......................#.................#......#..#.......#...#...##.....................
......................................#...#....................#...#.................#........#......#.....#...#....##.............
.......................................#......................................#..............#......#........#.......#.............
.............###.............##......#........#..#.#....#...###.#..............#..........#.........#...........#..#......#........
.................................................................S.................................................................
......##...#.....#........#.......#.#....#....#....#................#..#..#...................#.....#................#.#...#.......
...............................#.....................#...##.......#........#.#.........#......................#....#...............
........................#.......#.........#..........#............#....#...##.........#...#.#............................#.........
........#..#..............##...........#....#.##..###.....................................#.##.....#................#..#...........
............#...#.............##..............................#.#........#...#...............#............#.##.....##...#..........
.................#......................................#..#..................#.....#............#.......#.......................#.
..#...................#.................#.................#..#....#...#..#...........#.#.#...#..#.........#........#...............
....#.........#....#...............##...............#.........#......................#...........#.............#...................
..............##.............#.....#..................#.....#.#.....#................#...#..........#.........#......#.............
..................#...#...###.........###..............#.............#................#...........#...#..#..#.....#................
.#..#...............#..#...........................##...#...#...#........#..........##...#....#........#...........................
...............................#............#....#..............#..#.....#............#.......#..#........................#........
.....##............#.............##...#..#....#.......#............#..........#.................#...........#.................#....
.....#............................#.....#...##.............#......#.....#..#.....##.......................#........................
..#.....#..........................#.#............#........#.#.......#...#...#.....#......................##................#...#..
.......#..............................#..................#.........................................#...#..................#.#..#...
......#....#.............................#...#.......#.....#......................#.#..........#..............................#....
.#..........................#........................#......#.........#......................#...#........#...........#...#........
.............#............#................#.......................................#..###..#.....#.....#.#...............#.......#.
.#........#..............................#........#...........#...........................#...........#...................#........
.......##.#...##...............#.#...........##.......#.#..............................#.....#.......#...........#.................
....#...###.#...............................#...........................#..................#..#.#...#............##.#..#....#......
....##....##...#..#...................##..#...#.#.......#...#.......................#......##....................#....#........#...
..............................#....#...#...#..................#.....#...................#....#.........................##...#......
...........#.#....#................................#.....#..#.................#..##......#..#......#.........#........#...#......#.
............................................#.#..........#...#.#....#.................#......#.#.#.#.........#........#......#.....
....#..............................##........#............#......................#.#..........#..........................#.....#...
.............#...##..#.............#........#.....#...#...............#..............#...........##..............................#.
................#...............................#.#..................#...........#.............##........#.......#....#..###.......
.#..........##.........................................#......#.#..#............................#...............##.#...#...........
.##.................##...................#.....................#..............#.........#........................#.....#...#...#...
.....................................................#..........#.#...........#.#..........#...............#.....#.......#...#.....
.#.............#.....##......#........#....#......................#.#.....#......#.......#......................#.....#...#......#.
........#...##.....#........#.........#.#..#............#...#.......................................#............#.................
......##..............#...###...........#............#.....................#............#.#...........................#............
..##.#......#......#....#......#.................#................#....................##..............#.......#.#.#....#..........
..#.......#.#.....#.##.....#................#.#.........#.....#.......#............................#..............#................
...#.#....#..#...........#......................................#.....#..................................#.......#...#..#..#.......
...#....#..#........#.......#...............#.........#..#..#.##.....#................#............................................
...........#...#.#.............##..............#.#.......#......#.........#.#......#..............#...................#............
...#.....#..##.....#..#.........#................#...#..#............#..##.#....#..............#..#...............#................
...#.#........##.........#..........#...........................#......#...#.......##...................#........#.#..##.........#.
.#.....#....................##.#................#..#.##................#........#..................................#..#.#...#......
.#..........#.....#....#..........#...................#........##............#.................#............#.....##...........#...
...........#...#.........#.#.......##..............#.........#..........##......#................#............##..##...............
.......#...#...#.....#....#.............##..............................................##...#................................#....
.#....##.....#...........#..........#..#............#.....##.......##...............................#.#...........#....#.........#.
.......#...#...............#........###....#..............................#............#..#...................#...#.........#......
......#...#.....#..........#....####.......#.#..................................................###.......#......#..#............#.
.#..#.......#..#.#....#....##......#........#.........##....................#......................................................
...........#.#.................................................#..........#............##..#..............#......#...##....#...#...
.#....................#......#.................................#.......................................#...#.......................
...................#.....................#...............#.....#.......................#...........#..#............#...............
...............#..#..#....#......#......#.........#............##..................................#.#..........##............#....
......#.......#.......#...#.............#.......#..#........#......#...#...........#.......#....#..............#..#..#.............
.....#......#.......##.#......................................#......##........#...#.............#...#..#......#............#......
.#........#..#.............#..#....###.............#...............#..........#...#......#......#...#....#.#.........#..........#..
........#....#....#.....#....#..#.................#.............................#............................#............#........
.....#...............#...........#.##...........................................#.#......#.....#.#..#....#..............##...#.....
..#..#....#..................................#.......#.#..........#........................#.........#.....................#.##....
...#....#.............#...#............#..........#.#..#...........................#.............#...#.......#................#.#..
..............#.....#......#.......#..........#....##..#................#.....#.....##.....#....#...........#......#...............
......#..#........................#.........#.......##....#.............................................##.....##.......#......#...
.....#..#.....#........................................#..............#............#...#...........................#........#......
...................................................................................................................................'''

inp_s = '''\
...............
...#........#..
....#.....##...
...#.....#.....
.###..#...#.#..
....#...#..#...
...#.#...#.#...
.......S.......
...#......##...
.#.#.#..##..#..
..#.#....#.....
..#..#......#..
..#.....#.#....
....#.#..#...#.
...............'''

sam = 0
# sam = 0x0000000000000001
inp = inp_s if sam else inp_o

g = [list(l) for l in inp.split('\n')]
h = len(g)
w = len(g[0])

sy = sx = -1
for y in range(h):
    for x in range(w):
        if g[y][x] == 'S':
            sy = y
            sx = x

D = [(0, 1), (1, 0), (0, -1), (-1, 0)]
L = 26501365
# L = 1113
# L = 851
# L = 589
# L = 327
if sam:
    L = 187


def test(L):
    q = deque([(int(0), sy, sx)])
    seen = [set(), set()]
    seen[0].add((sy, sx))
    while q:
        d, y, x = q.popleft()
        for dy, dx in D:
            ny = y + dy
            nx = x + dx
            if g[ny % h][nx % h] == '#':
                continue
            if (ny, nx) in seen[d % 2 ^ 1]:
                continue
            seen[d % 2 ^ 1].add((ny, nx))
            if d + 1 < L:
                q.append((d + 1, ny, nx))
    byb = Counter()
    for y, x in seen[L % 2]:
        byb[(floor(y / h), floor(x / h))] += 1
    return len(seen[L % 2]), byb


T = []
if L <= 1234:
    T = test(L)


def calc_corn(sy, sx):
    dist = [[inf] * w for _ in range(h)]
    q = deque([(int(0), sy, sx)])
    dist[sy][sx] = 0
    while q:
        d, y, x = q.popleft()
        for dy, dx in D:
            ny = y + dy
            nx = x + dx
            if ny < 0 or ny >= h or nx < 0 or nx >= w or g[ny][nx] == '#':
                continue
            if dist[ny][nx] < inf:
                continue
            dist[ny][nx] = d + 1
            q.append((d + 1, ny, nx))
    return dist


corn = [[calc_corn([0, sy, h - 1][y], [0, sx, w - 1][x]) for x in range(3)]
        for y in range(3)]

corn_upto = [[[[
    sum((y2 + x2) % 2 == p and corn[y][x][y2][x2] <= d for y2 in range(h)
        for x2 in range(w)) for d in range(2 * h)
] for x in range(3)] for y in range(3)] for p in range(2)]

# base = [
#     sum(1 for y in range(h) for x in range(w)
#         if g[y][x] != '#' and (y + x) % 2 == p) for p in range(2)
# ]

base = [corn_upto[p][0][0][-1] for p in range(2)]

ed = 0
edb = set()


def reach(p, by, bx):
    # print('reach', p, by, bx)
    global ed
    corn_d = 0
    if by:
        corn_d += (abs(by) - 1) * h + (h // 2 + 1)
    if bx:
        corn_d += (abs(bx) - 1) * h + (h // 2 + 1)
    ans = corn_upto[p][1 - numpy.sign(by)][1 - numpy.sign(bx)][L - corn_d]
    if T:
        ed += T[1][(by, bx)]
        edb.add((by, bx))
        assert ans == T[1][(by, bx)]
    return ans


ans = 0
BL = round(L / h - 0.5)
print('L', L, 'BL', BL)
ed = 0
for by in range(1, BL):
    bx = BL - by
    ans += reach(1, by, bx)
    ans += reach(1, by, -bx)
    ans += reach(1, -by, bx)
    ans += reach(1, -by, -bx)
    if by + 1:
        ans += reach(0, by + 1, bx)
        ans += reach(0, by + 1, -bx)
        ans += reach(0, -by - 1, bx)
        ans += reach(0, -by - 1, -bx)

ans += reach(1, 0, BL)
ans += reach(1, 0, -BL)
ans += reach(0, 1, BL)
ans += reach(0, 1, -BL)
ans += reach(0, -1, BL)
ans += reach(0, -1, -BL)
ans += reach(1, BL, 0)
ans += reach(1, -BL, 0)


def calc_b(BL):
    B0 = 4 * (BL // 2)**2
    B1 = 1 + 8 * ((1 + (BL - 2) // 2) * ((BL - 2) // 2) // 2)
    return B0, B1


# for bl in range(2, 42, 2):
#     print(calc_b(bl))

B0, B1 = calc_b(BL)
print('B', B0, B1)
print('base', base)

print('ed', ed, 'ans', ans)
if T:
    print('expected inner', T[0] - ed)
    cti = [0, 0]
    for (by, bx), c in T[1].items():
        if (by, bx) not in edb:
            cti[(by + bx) % 2 ^ 1] += c
    print('expected cti', cti, cti[0] / base[0], cti[0] / base[1],
          cti[1] / base[0], cti[1] / base[1])

inner = [base[0] * B0, base[1] * B1]
print('inner', inner)

ans += sum(inner)

print(ans)
if T:
    print(T[0])
